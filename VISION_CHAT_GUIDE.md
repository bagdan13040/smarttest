# AI Vision Chat - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω —á–∞—Ç —Å AI Vision –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

## –§—É–Ω–∫—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ù–∞ Android:**
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üìé –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≥–∞–ª–µ—Ä–µ–∏
- –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (READ_EXTERNAL_STORAGE)
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∏–∫–æ–Ω–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ üì∑

**–ù–∞ Desktop:**
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üìé
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω—ã–π file picker (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω plyer)
- Fallback: –¥–∏–∞–ª–æ–≥ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –≤–≤–æ–¥–æ–º URL –∏–ª–∏ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF, WEBP, BMP

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

- **–¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç**: –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ‚Üí
- **–¢–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ üìé, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç, –Ω–∞–∂–º–∏—Ç–µ ‚Üí
- **–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞

### 3. –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞

- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–ø—Ä–∞–≤–∞ (—Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω)
- –û—Ç–≤–µ—Ç—ã AI —Å–ª–µ–≤–∞ (—Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω)
- –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–µ–≤—å—é (100x100px)
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç

## API

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback)

1. **google/gemini-2.0-flash-exp:free** (primary) - –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è, –Ω–æ —Å rate limits
2. **qwen/qwen-2-vl-7b-instruct:free** (fallback 1)
3. **meta-llama/llama-3.2-11b-vision-instruct:free** (fallback 2)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- API –∫–ª—é—á OpenRouter –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (Android)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Desktop
```bash
pip install plyer
```

### Android (buildozer)
```bash
buildozer android debug
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:
- plyer (–¥–ª—è file picker)
- certifi (–¥–ª—è SSL)
- pyjnius (–¥–ª—è Android API)

## –†–∞–∑—Ä–µ—à–µ–Ω–∏—è Android

–í `buildozer.spec` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã:
- `READ_EXTERNAL_STORAGE` - –¥–ª—è Android 6-12
- `READ_MEDIA_IMAGES` - –¥–ª—è Android 13+ (API 33+)
- `INTERNET` - –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ SmartTest
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "AI" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
3. –û—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç —Å AI
4. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π üìé (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ
6. –ù–∞–∂–º–∏—Ç–µ ‚Üí –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ
- "–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é —Ñ–∏–∑–∏–∫—É –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏"
- "–ù–∞–ø–∏—à–∏ –∫–æ–¥ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—É–∑—ã—Ä—å–∫–æ–º –Ω–∞ Python"

### –° –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ –∫–æ—Ç–∞ ‚Üí "–ß—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ?"
- –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞ ‚Üí "–ù–∞–π–¥–∏ –æ—à–∏–±–∫—É –≤ —ç—Ç–æ–º –∫–æ–¥–µ"
- –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É–ª—É ‚Üí "–†–µ—à–∏ —ç—Ç–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ"

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### Rate Limits
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
- –ï—Å–ª–∏ –≤—Å–µ 3 –º–æ–¥–µ–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞

### –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ base64
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: –¥–æ 2-3 MB
- –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å —Ç–∞–π–º–∞—É—Ç

### –§–æ—Ä–º–∞—Ç—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, JPEG, PNG, GIF, WEBP, BMP
- MIME type –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTP/HTTPS

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

### ChatScreen (main.py)

```python
class ChatScreen(Screen):
    chat_history = ListProperty([])      # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    selected_image = StringProperty(None) # –ü—É—Ç—å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
    
    def send_message(self):              # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    def show_image_chooser(self):        # –í—ã–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    def _show_text_input_chooser(self):  # Fallback –¥–∏–∞–ª–æ–≥
    def add_message(self, text, role, image): # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ UI
```

### Vision API (llm.py)

```python
def chat_with_image(message, image_path, history, api_key, model):
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –º–µ–∂–¥—É 3 –º–æ–¥–µ–ª—è–º–∏
    # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ text-only –∏ multimodal –∑–∞–ø—Ä–æ—Å–æ–≤
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"content": text, "role": "assistant"} –∏–ª–∏ {"error": message}

def encode_image_to_base64(image_path):
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64 —Å MIME type
    # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTP URL –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

## –û—Ç–ª–∞–¥–∫–∞

### Android
```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb logcat | grep python

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
adb shell pm list permissions -g

# –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb shell dumpsys package com.smarttest.app | grep permission
```

### Desktop
```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
python main.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ plyer
python -c "from plyer import filechooser; print('OK')"
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### File picker –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è (Android)
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Android
2. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback: –≤–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å `/sdcard/DCIM/...`

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å JPG/PNG/GIF/WEBP)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä (–±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è)

### 429 Too Many Requests
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
- –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞–Ω—è—Ç—ã - –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç

### –û—à–∏–±–∫–∞ "API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∫–æ–Ω–∫–∞ —Å–ø—Ä–∞–≤–∞)
2. –í—Å—Ç–∞–≤—å—Ç–µ API –∫–ª—é—á OpenRouter (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-or-`)
3. –ù–∞–∂–º–∏—Ç–µ "–°–û–•–†–ê–ù–ò–¢–¨"
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v1.5 (03.01.2026)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω AI Vision Chat
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è plyer –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ file picker
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –º–µ–∂–¥—É 3 vision –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Android –≥–∞–ª–µ—Ä–µ–∏
- ‚úÖ –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —á–∞—Ç–µ
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è Android 13+

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –ö–∞–º–µ—Ä–∞ –¥–ª—è —Å—ä—ë–º–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –°–∂–∞—Ç–∏–µ –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
- [ ] –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞ —Ä–∞–∑
